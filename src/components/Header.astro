---
import { Image } from "astro:assets";
import KotacomLogo from "../assets/kotacom-logo.svg";
import ThemeToggle from "./ThemeToggle.astro";
import UnifiedMegaMenu from "./UnifiedMegaMenu.astro";
import MobileUnifiedMegaMenu from "./MobileUnifiedMegaMenu.astro";
import { MEGA_MENU_CONFIG, SIMPLE_NAV_ITEMS, MOBILE_MENU_CONFIG } from "../data/mega-menu-config";
---

<a href="#main-content" class="sr-only focus:not-sr-only absolute left-2 top-2 bg-white text-black p-2 z-50 rounded">
  Skip to main content
</a>

<nav class="bg-white border-gray-200 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 shadow-sm sticky top-0 z-40">
  <div class="flex flex-wrap items-center justify-between max-w-screen-xl mx-auto p-4">
    <!-- Logo -->
    <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse">
      <Image src={KotacomLogo} class="h-8 w-auto" alt="kotacom.id" />
      <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">kotacom.id</span>
    </a>
    
    <!-- Right side buttons and mobile menu toggle -->
    <div class="flex items-center md:order-2 space-x-1 md:space-x-2 rtl:space-x-reverse">
      <!-- Theme toggle -->
      <div class="mr-2">
        <ThemeToggle />
      </div>
      
      <!-- Search button -->
      <button
        id="search-button"
        type="button"
        class="text-gray-800 dark:text-white hover:bg-gray-50 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-sm px-4 py-2 md:px-5 md:py-2.5 dark:hover:bg-gray-700 focus:outline-none dark:focus:ring-gray-800"
      >
        <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
        </svg>
        Search
      </button>
      
      <!-- Mobile menu toggle -->
      <button 
        data-collapse-toggle="mega-menu-icons" 
        type="button" 
        class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" 
        aria-controls="mega-menu-icons" 
        aria-expanded="false"
      >
        <span class="sr-only">Open main menu</span>
        <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
        </svg>
      </button>
    </div>
    
    <!-- Navigation menu -->
    <div id="mega-menu-icons" class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1">
      <ul class="flex flex-col mt-4 font-medium md:flex-row md:mt-0 md:space-x-8 rtl:space-x-reverse">
        <!-- Home -->
        <li>
          <a href="/" class="block py-2 px-3 text-blue-600 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-blue-500 md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700" aria-current="page">Home</a>
        </li>
        
        <!-- Services Mega Menu -->
        <li>
          <button 
            id="services-mega-menu-dropdown-button" 
            data-dropdown-toggle="services-mega-menu-dropdown" 
            class="flex items-center justify-between w-full py-2 px-3 font-medium text-gray-900 border-b border-gray-100 md:w-auto hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700"
          >
            Services
            <svg class="w-2.5 h-2.5 ms-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 4 4 4-4"/>
            </svg>
          </button>
          <div id="services-mega-menu-dropdown" class="absolute z-10 grid hidden w-auto grid-cols-2 text-sm bg-white border border-gray-100 rounded-lg shadow-md dark:border-gray-700 md:grid-cols-3 dark:bg-gray-700">
            <!-- Website Development -->
            <div class="p-4 pb-0 text-gray-900 md:pb-4 dark:text-white">
              <ul class="space-y-4" aria-labelledby="services-mega-menu-dropdown-button">
                <li>
                  <a href="/jasa-pembuatan-website-surabaya" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                    </svg>
                    Website Development
                  </a>
                </li>
                <li>
                  <a href="/jasa-pembuatan-software" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="m1.56 6.245 8 3.924a1 1 0 0 0 .88 0l8-3.924a1 1 0 0 0 0-1.8l-8-3.925a1 1 0 0 0-.88 0l-8 3.925a1 1 0 0 0 0 1.8Z"/>
                    </svg>
                    Software Development
                  </a>
                </li>
                <li>
                  <a href="/pembuatan-website/" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M12 0H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM7.5 17.5h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2ZM12 13H2V4h10v9Z"/>
                    </svg>
                    Mobile App Development
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- IT Support -->
            <div class="p-4 pb-0 text-gray-900 md:pb-4 dark:text-white">
              <ul class="space-y-4">
                <li>
                  <a href="/services/it-support" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="m17.418 3.623-.018-.008a6.713 6.713 0 0 0-2.4-.569V2h1a1 1 0 1 0 0-2h-2a1 1 0 0 0-1 1v2H9.89A6.977 6.977 0 0 1 12 8v5h-2V8A5 5 0 1 0 0 8v6a1 1 0 0 0 1 1h8v4a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1v-4h6a1 1 0 0 0 1-1V8a5 5 0 0 0-2.582-4.377ZM6 12H4a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2Z"/>
                    </svg>
                    IT Support
                  </a>
                </li>
                <li>
                  <a href="/services/network-setup" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M6.143 0H1.857A1.857 1.857 0 0 0 0 1.857v4.286C0 7.169.831 8 1.857 8h4.286A1.857 1.857 0 0 0 8 6.143V1.857A1.857 1.857 0 0 0 6.143 0Zm10 0h-4.286A1.857 1.857 0 0 0 10 1.857v4.286C10 7.169 10.831 8 11.857 8h4.286A1.857 1.857 0 0 0 18 6.143V1.857A1.857 1.857 0 0 0 16.143 0Zm-10 10H1.857A1.857 1.857 0 0 0 0 11.857v4.286C0 17.169.831 18 1.857 18h4.286A1.857 1.857 0 0 0 8 16.143v-4.286A1.857 1.857 0 0 0 6.143 10ZM17 13h-2v-2a1 1 0 0 0-2 0v2h-2a1 1 0 0 0 0 2h2v2a1 1 0 0 0 2 0v-2h2a1 1 0 0 0 0-2Z"/>
                    </svg>
                    Network Setup
                  </a>
                </li>
                <li>
                  <a href="/services/consultation" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                    </svg>
                    Digital Consultation
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- Printing & Design -->
            <div class="p-4 text-gray-900 dark:text-white">
              <ul class="space-y-4">
                <li>
                  <a href="/categories/percetakan" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20">
                      <path d="M12 0H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM7.5 17.5h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2ZM12 13H2V4h10v9Z"/>
                    </svg>
                    Printing Services
                  </a>
                </li>
                <li>
                  <a href="/services/" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                      <path d="M15.977.783A1 1 0 0 0 15 0H3a1 1 0 0 0-.977.783L.2 9h4.239a2.99 2.99 0 0 1 2.742 1.8 1.977 1.977 0 0 0 3.638 0A2.99 2.99 0 0 1 13.561 9H17.8L15.977.783ZM6 2h6a1 1 0 1 1 0 2H6a1 1 0 0 1 0-2Zm7 5H5a1 1 0 0 1 0-2h8a1 1 0 1 1 0 2Z"/>
                    </svg>
                    Graphic Design
                  </a>
                </li>
                <li>
                  <a href="/contact" class="flex items-center text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-500 group">
                    <svg class="w-3 h-3 me-2 text-gray-400 dark:text-gray-500 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 14 20">
                      <path d="M12 0H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2ZM7.5 17.5h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2ZM12 13H2V4h10v9Z"/>
                    </svg>
                    Contact Us
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </li>
        
        <!-- Portfolio -->
        <li>
          <a href="/projects" class="block py-2 px-3 text-gray-900 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700">Portfolio</a>
        </li>
        
        <!-- Products -->
        <li>
          <a href="/products" class="block py-2 px-3 text-gray-900 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700">Products</a>
        </li>
        
        <!-- Posts -->
        <li>
          <a href="/posts" class="block py-2 px-3 text-gray-900 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700">Posts</a>
        </li>
        
        <!-- About -->
        <li>
          <a href="/about" class="block py-2 px-3 text-gray-900 border-b border-gray-100 hover:bg-gray-50 md:hover:bg-transparent md:border-0 md:hover:text-blue-600 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-blue-500 md:dark:hover:bg-transparent dark:border-gray-700">About</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Full Screen Mobile Menu -->
<div
  id="fullscreen-mobile-menu"
  class="fixed inset-0 z-50 bg-white dark:bg-gray-900 transform translate-x-full transition-transform duration-300 ease-in-out lg:hidden overflow-hidden flex flex-col"
  role="dialog"
  aria-modal="true"
  aria-labelledby="mobile-menu-title"
>
  <!-- Mobile Menu Header -->
  <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 flex-shrink-0 bg-white dark:bg-gray-900">
    <a href="/" class="flex items-center focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 rounded">
      <Image src={KotacomLogo} class="h-8 w-auto" alt="kotacom.id" />
      <span class="ml-3 text-xl font-semibold text-gray-900 dark:text-white">kotacom.id</span>
    </a>
    <button
      id="close-mobile-menu"
      type="button"
      class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
      aria-label="Close mobile menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>

  <!-- Mobile Menu Content - Scrollable -->
  <div class="flex-1 overflow-y-auto overscroll-contain min-h-0" style="height: calc(100vh - 80px);">
    <nav class="p-4 space-y-2" role="navigation">
      <!-- Mobile: Unified Mega Menu Items -->
      <div class="space-y-2">
        <MobileUnifiedMegaMenu 
          trigger={MEGA_MENU_CONFIG.layanan.trigger}
          sections={MEGA_MENU_CONFIG.layanan.sections}
        />
        <MobileUnifiedMegaMenu 
          trigger={MEGA_MENU_CONFIG.portfolio.trigger}
          sections={MEGA_MENU_CONFIG.portfolio.sections}
        />
        <MobileUnifiedMegaMenu 
          trigger={MEGA_MENU_CONFIG.produk.trigger}
          sections={MEGA_MENU_CONFIG.produk.sections}
        />
        
        <!-- Simple Navigation Items on Mobile -->
        <div class="pt-4 mt-4">
          {MOBILE_MENU_CONFIG.secondaryItems.map((item) => (
            <a
              href={item.url}
              class="block py-3 px-4 text-gray-700 hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-800 dark:hover:text-white font-medium transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 rounded-md"
            >
              {item.title}
            </a>
          ))}
        </div>
        
        <!-- Mobile Menu Footer -->
        <div class="pt-4 mt-4 pb-8">
          <div class="text-center">
            <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-2">
              {MOBILE_MENU_CONFIG.footer.title}
            </h4>
            <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">
              {MOBILE_MENU_CONFIG.footer.description}
            </p>
            <a
              href={MOBILE_MENU_CONFIG.footer.cta.url}
              class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors duration-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500"
            >
              <div class="text-white" set:html={MOBILE_MENU_CONFIG.footer.cta.icon}></div>
              {MOBILE_MENU_CONFIG.footer.cta.text}
            </a>
          </div>
        </div>
      </div>
    </nav>
  </div>
</div>

<!-- Simple Search Modal -->
<div
  id="search-modal"
  role="dialog"
  aria-modal="true"
  aria-labelledby="search-modal-title"
  data-modal-placement="top-center"
  tabindex="-1"
  aria-hidden="true"
  class="hidden fixed inset-0 z-50 overflow-y-auto overflow-x-hidden backdrop-blur-sm bg-gray-900/50 dark:bg-gray-900/80"
>
  <!-- Modal backdrop -->
  <div class="flex items-start justify-center min-h-full p-4 sm:p-6 lg:p-8 pt-4 sm:pt-[15vh]">
    <!-- Modal content -->
    <div class="relative w-full max-w-4xl mx-auto bg-white rounded-xl shadow-2xl dark:bg-gray-800 transform transition-all">
      
      <!-- Search Form -->
      <form id="modal-search-form" action="/search" method="get" class="p-6">
        <div class="flex items-center space-x-3">
          <div class="flex-shrink-0">
            <svg class="w-6 h-6 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <path stroke="currentColor" stroke-linecap="round" stroke-width="2" d="m21 21-3.5-3.5M17 10a7 7 0 1 1-14 0 7 7 0 0 1 14 0Z"/>
            </svg>
          </div>
          <div class="flex-1">
            <input
              type="search"
              name="q"
              id="modal-search-input"
              placeholder="Cari layanan, portfolio, atau artikel..."
              class="w-full text-lg bg-transparent border-0 outline-none text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-0"
              autocomplete="off"
              autofocus
            />
          </div>
          <div class="flex-shrink-0">
            <button
              id="close-search-modal"
              type="button"
              class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
              aria-label="Close search"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Search suggestions -->
        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Layanan Populer</h4>
              <div class="space-y-2">
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="website development">
                  Website Development
                </button>
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="software development">
                  Software Development
                </button>
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="social media management">
                  Social Media Management
                </button>
              </div>
            </div>
            <div>
              <h4 class="text-sm font-medium text-gray-900 dark:text-white mb-3">Kategori IT</h4>
              <div class="space-y-2">
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="IT service">
                  IT Service & Support
                </button>
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="hardware">
                  Hardware & Software
                </button>
                <button type="button" class="search-suggestion block w-full text-left px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors cursor-pointer" data-query="publications">
                  Publications & Content
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>

      <!-- Footer -->
      <div class="hidden sm:flex items-center justify-between px-6 py-4 bg-gray-50 dark:bg-gray-700/50 rounded-b-xl border-t border-gray-200 dark:border-gray-700">
        <div class="flex items-center space-x-4 text-xs text-gray-500 dark:text-gray-400">
          <div class="flex items-center space-x-1">
            <kbd class="px-2 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded text-xs">↵</kbd>
            <span>to search</span>
          </div>
          <div class="flex items-center space-x-1">
            <kbd class="px-2 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded text-xs">esc</kbd>
            <span>to close</span>
          </div>
        </div>
        <div class="flex space-x-2">
          <a href="/contact" class="inline-flex items-center px-3 py-1.5 text-xs font-medium text-gray-700 bg-white hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg transition-colors cursor-pointer">
            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
            </svg>
            Konsultasi Gratis
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchModal = document.getElementById("search-modal");
    const modalSearchInput = document.getElementById("modal-search-input") as HTMLInputElement;
    const modalSearchForm = document.getElementById("modal-search-form") as HTMLFormElement;
    const searchSuggestions = document.querySelectorAll(".search-suggestion");
    const searchButton = document.getElementById("search-button");
    
    // Mobile menu elements
    const mobileMenuToggle = document.querySelector('[data-collapse-toggle="mega-menu-icons"]') as HTMLElement;
    const fullscreenMobileMenu = document.getElementById("fullscreen-mobile-menu") as HTMLElement;
    const closeMobileMenu = document.getElementById("close-mobile-menu") as HTMLElement;

    // Mega menu dropdown functionality
    const servicesDropdownButton = document.getElementById("services-mega-menu-dropdown-button");
    const servicesDropdown = document.getElementById("services-mega-menu-dropdown");
    
    if (servicesDropdownButton && servicesDropdown) {
      servicesDropdownButton.addEventListener("click", () => {
        const isExpanded = servicesDropdownButton.getAttribute("aria-expanded") === "true";
        servicesDropdownButton.setAttribute("aria-expanded", !isExpanded);
        servicesDropdown.classList.toggle("hidden");
      });
      
      // Close dropdown when clicking outside
      document.addEventListener("click", (e) => {
        if (!servicesDropdownButton?.contains(e.target as Node) && !servicesDropdown?.contains(e.target as Node)) {
          servicesDropdownButton?.setAttribute("aria-expanded", "false");
          servicesDropdown?.classList.add("hidden");
        }
      });
    }

    // Detect OS and update keyboard shortcut display
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const searchKbd = document.getElementById('search-kbd');
    
    if (searchKbd && !isMac) {
      // Replace ⌘K with Ctrl+K for Windows/Linux
      searchKbd.textContent = 'Ctrl+K';
    }

    // Mobile menu functionality
    if (mobileMenuToggle && fullscreenMobileMenu && closeMobileMenu) {
      mobileMenuToggle.addEventListener("click", (e) => {
        e.preventDefault();
        fullscreenMobileMenu.classList.remove('translate-x-full');
        document.body.style.overflow = 'hidden';
      });

      closeMobileMenu.addEventListener("click", () => {
        fullscreenMobileMenu.classList.add('translate-x-full');
        document.body.style.overflow = '';
      });

      // Close on backdrop click
      fullscreenMobileMenu.addEventListener("click", (e) => {
        if (e.target === fullscreenMobileMenu) {
          fullscreenMobileMenu.classList.add('translate-x-full');
          document.body.style.overflow = '';
        }
      });

      // Close on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !fullscreenMobileMenu.classList.contains('translate-x-full')) {
          fullscreenMobileMenu.classList.add('translate-x-full');
          document.body.style.overflow = '';
        }
      });
    }

    // Custom modal show/hide functions to ensure proper focus handling
    function showModal() {
      if (searchModal) {
        searchModal.classList.remove('hidden');
        searchModal.setAttribute('aria-hidden', 'false');
        // Focus input immediately in the same event cycle
        if (modalSearchInput) {
          if (typeof modalSearchInput.focus === 'function') modalSearchInput.focus();
          // Force click on input for iOS keyboard (sometimes needed)
          if (typeof modalSearchInput.click === 'function') modalSearchInput.click();
        }
      }
    }

    function hideModal() {
      if (searchModal) {
        searchModal.classList.add('hidden');
        searchModal.setAttribute('aria-hidden', 'true');
      }
    }

    // Handle search button click
    if (searchButton) {
      searchButton.addEventListener("click", (e) => {
        e.preventDefault();
        showModal();
      });
    }

    // Handle close button clicks
    const closeButton = document.getElementById("close-search-modal");
    if (closeButton) {
      closeButton.addEventListener("click", (e) => {
        e.preventDefault();
        hideModal();
      });
    }

    // Handle backdrop clicks
    if (searchModal) {
      searchModal.addEventListener("click", (e) => {
        // Only close if clicking the backdrop (not the modal content)
        if (e.target === searchModal) {
          hideModal();
        }
      });
    }

    // Handle global keyboard shortcut and escape key
    document.addEventListener("keydown", (e) => {
      // Check for Cmd+K (Mac) or Ctrl+K (Windows/Linux)
      if ((isMac && e.metaKey && e.key === 'k') || (!isMac && e.ctrlKey && e.key === 'k')) {
        e.preventDefault();
        showModal();
        return;
      }

      // Handle escape key to close modal
      if (e.key === "Escape" && searchModal && !searchModal.classList.contains("hidden")) {
        hideModal();
      }
    });

    // Handle form submission
    if (modalSearchForm) {
      modalSearchForm.addEventListener("submit", (e) => {
        const query = modalSearchInput?.value?.trim();
        if (!query) {
          e.preventDefault();
          return;
        }
        // Form will naturally submit to /search?q=query
      });
    }

    // Handle search suggestions
    searchSuggestions.forEach(button => {
      button.addEventListener("click", () => {
        const query = button.getAttribute("data-query");
        if (query && modalSearchInput) {
          modalSearchInput.value = query;
          if (modalSearchForm && typeof modalSearchForm.submit === 'function') {
            modalSearchForm.submit();
          }
        }
      });
    });
  });
</script>

<style>
  /* Mobile menu specific styles */
  #fullscreen-mobile-menu {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100vw;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
  }
  
  #fullscreen-mobile-menu .flex-1 {
    flex: 1 1 auto;
    min-height: 0;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    height: calc(100vh - 80px); /* Explicit height for mobile */
  }
  
  /* Ensure proper scrolling on mobile devices */
  @media (max-width: 1024px) {
    #fullscreen-mobile-menu .flex-1 {
      overflow-y: scroll;
      scrollbar-width: thin;
      scrollbar-color: #cbd5e0 transparent;
      height: calc(100vh - 80px);
    }
    
    #fullscreen-mobile-menu .flex-1::-webkit-scrollbar {
      width: 6px;
    }
    
    #fullscreen-mobile-menu .flex-1::-webkit-scrollbar-track {
      background: transparent;
    }
    
    #fullscreen-mobile-menu .flex-1::-webkit-scrollbar-thumb {
      background: #cbd5e0;
      border-radius: 3px;
    }
    
    #fullscreen-mobile-menu .flex-1::-webkit-scrollbar-thumb:hover {
      background: #a0aec0;
    }
  }
  
  /* Dark mode scrollbar */
  .dark #fullscreen-mobile-menu .flex-1::-webkit-scrollbar-thumb {
    background: #4a5568;
  }
  
  .dark #fullscreen-mobile-menu .flex-1::-webkit-scrollbar-thumb:hover {
    background: #718096;
  }
  
  /* Ensure mobile menu content is properly spaced */
  #fullscreen-mobile-menu nav {
    min-height: 100%;
    padding-bottom: 2rem;
  }
  
  /* Mobile menu header sticky positioning */
  #fullscreen-mobile-menu .flex-shrink-0 {
    position: sticky;
    top: 0;
    z-index: 10;
    background: inherit;
  }
  
  /* Force mobile menu to be scrollable */
  #fullscreen-mobile-menu .flex-1 {
    overflow-y: scroll !important;
    -webkit-overflow-scrolling: touch !important;
  }
  
  /* Ensure content doesn't get cut off */
  #fullscreen-mobile-menu nav {
    padding-bottom: 4rem;
  }
  
  /* Mega menu dropdown styles */
  #services-mega-menu-dropdown {
    top: 100%;
    left: 0;
    margin-top: 0.5rem;
  }
  
  /* Ensure mega menu is above other content */
  #services-mega-menu-dropdown {
    z-index: 50;
  }
</style>