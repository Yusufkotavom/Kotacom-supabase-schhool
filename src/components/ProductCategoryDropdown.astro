---
interface Props {
  categoryCounts: Record<string, number>;
}

const { categoryCounts } = Astro.props as Props;

const pathSegments = Astro.url.pathname.split("/");
const potentialCategory = pathSegments[2];
const currentCategory = potentialCategory && potentialCategory.trim() !== "" ? potentialCategory : null;

function toSlug(name: string): string {
  return String(name).toLowerCase().replace(/\s+/g, "-");
}

const uniqueCategories = Object.keys(categoryCounts).sort();
---
<form class="w-100%">
  <select
    id="categories"
    class="bg-white border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
    onchange="if (this.value) window.location.href = this.value"
  >
    <option 
      value="/products/"
      selected={!currentCategory}
    >
      Semua Kategori
    </option>
    {uniqueCategories.map((category) => {
      const categorySlug = toSlug(category);
      const count = categoryCounts[category] || 0;
      return (
        <option
          value={`/products/${categorySlug}/`}
          selected={currentCategory === categorySlug}
        >
          {category} ({count})
        </option>
      );
    })}
  </select>
</form>