---
interface Props {
  className?: string;
}

const { className = '' } = Astro.props;

// School gallery images
const galleryImages = [
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Kegiatan Belajar Mengajar",
    title: "Kegiatan Belajar Mengajar",
    description: "Suasana belajar yang nyaman dan menyenangkan"
  },
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Fasilitas Laboratorium",
    title: "Laboratorium Sains",
    description: "Eksperimen sains yang menarik dan edukatif"
  },
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Perpustakaan Sekolah",
    title: "Perpustakaan",
    description: "Tempat membaca dan belajar yang nyaman"
  },
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Area Bermain",
    title: "Area Bermain",
    description: "Tempat bermain dan bersosialisasi siswa"
  },
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Kegiatan Ekstrakurikuler",
    title: "Ekstrakurikuler",
    description: "Kegiatan tambahan untuk mengembangkan bakat"
  },
  {
    src: "https://res.cloudinary.com/dwxw1h9my/image/upload/f_auto,q_auto,w_auto,dpr_auto/v1753726244/kotacom/website-images/Web_Development_hero.jpg",
    alt: "Upacara Bendera",
    title: "Upacara Bendera",
    description: "Menanamkan nilai-nilai kebangsaan"
  }
];
---

<section class={`py-12 sm:py-16 lg:py-20 px-4 sm:px-6 lg:px-8 ${className} section-bg-light dark:section-bg-dark relative overflow-hidden`}>
  <!-- Lightweight Floating Elements - Only on larger screens -->
  <div class="floating-elements">
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
    <div class="floating-shape"></div>
  </div>
  
  <div class="max-w-7xl mx-auto relative z-10">
    <!-- Section Header -->
    <div class="text-center mb-12 sm:mb-16" data-reveal="fade-up">
      <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold mb-4 sm:mb-6">
        <span class="bg-gradient-to-r from-blue-600 via-red-600 to-yellow-600 bg-clip-text text-transparent">
          Galeri Sekolah
        </span>
      </h2>
      <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto px-4">
        Jelajahi suasana dan kegiatan belajar mengajar di SD Muhammadiyah 20 Surabaya
      </p>
    </div>
    
    <!-- Swipe Gallery Container -->
    <div class="relative" data-reveal="fade-up" data-reveal-delay="200">
      <!-- Gallery Container -->
      <div class="gallery-container overflow-hidden rounded-2xl shadow-2xl">
        <div class="gallery-track flex transition-transform duration-500 ease-out" id="gallery-track">
          {galleryImages.map((image, index) => (
            <div class="gallery-slide flex-shrink-0 w-full sm:w-1/2 lg:w-1/3 xl:w-1/4 px-2">
              <div class="relative group cursor-pointer">
                <div class="relative overflow-hidden rounded-xl shadow-lg">
                  <img 
                    src={image.src} 
                    alt={image.alt} 
                    class="w-full h-48 sm:h-56 lg:h-64 object-cover transition-transform duration-500 group-hover:scale-110"
                    loading="lazy"
                  />
                  <!-- Overlay -->
                  <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                  
                  <!-- Content -->
                  <div class="absolute bottom-0 left-0 right-0 p-4 text-white transform translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                    <h3 class="text-lg font-bold mb-2">{image.title}</h3>
                    <p class="text-sm opacity-90">{image.description}</p>
                  </div>
                  
                  <!-- Decorative elements -->
                  <div class="absolute top-3 right-3 w-3 h-3 bg-yellow-400 rounded-full animate-ping opacity-75"></div>
                  <div class="absolute bottom-3 left-3 w-2 h-2 bg-blue-400 rounded-full animate-pulse"></div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button class="gallery-nav gallery-prev absolute left-4 top-1/2 transform -translate-y-1/2 w-12 h-12 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-all duration-300 z-10" aria-label="Previous">
        <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
      </button>
      
      <button class="gallery-nav gallery-next absolute right-4 top-1/2 transform -translate-y-1/2 w-12 h-12 bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-lg hover:bg-white dark:hover:bg-gray-700 transition-all duration-300 z-10" aria-label="Next">
        <svg class="w-6 h-6 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
      </button>
      
      <!-- Dots Indicator -->
      <div class="flex justify-center mt-6 space-x-2" id="gallery-dots">
        {galleryImages.map((_, index) => (
          <button 
            class="gallery-dot w-3 h-3 rounded-full bg-gray-300 dark:bg-gray-600 hover:bg-blue-500 dark:hover:bg-blue-400 transition-all duration-300"
            data-index={index}
            aria-label={`Go to slide ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>
    
    <!-- Gallery Info -->
    <div class="text-center mt-8 sm:mt-12" data-reveal="fade-up" data-reveal-delay="400">
      <p class="text-gray-600 dark:text-gray-300 mb-4">
        Geser kiri/kanan untuk melihat lebih banyak foto
      </p>
      <div class="flex justify-center space-x-4">
        <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
          </svg>
          <span>Swipe kiri</span>
        </div>
        <div class="flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400">
          <span>Swipe kanan</span>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
          </svg>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Lottie Separator -->
  <SchoolLottieSeparator animation="school" height="h-16 sm:h-20" className="mt-12 sm:mt-16" />
</section>

<script>
  class SwipeGallery {
    constructor() {
      this.track = document.getElementById('gallery-track');
      this.slides = this.track?.querySelectorAll('.gallery-slide');
      this.dots = document.querySelectorAll('.gallery-dot');
      this.prevBtn = document.querySelector('.gallery-prev');
      this.nextBtn = document.querySelector('.gallery-next');
      
      this.currentIndex = 0;
      this.slideWidth = 0;
      this.maxIndex = 0;
      
      this.init();
    }
    
    init() {
      if (!this.track || !this.slides) return;
      
      this.slideWidth = this.slides[0].offsetWidth;
      this.maxIndex = this.slides.length - 1;
      
      // Set initial state
      this.updateDots();
      this.updateNavButtons();
      
      // Event listeners
      this.prevBtn?.addEventListener('click', () => this.prev());
      this.nextBtn?.addEventListener('click', () => this.next());
      
      // Dot navigation
      this.dots.forEach((dot, index) => {
        dot.addEventListener('click', () => this.goToSlide(index));
      });
      
      // Touch/swipe events
      this.initTouchEvents();
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') this.prev();
        if (e.key === 'ArrowRight') this.next();
      });
      
      // Auto-play (optional)
      this.startAutoPlay();
    }
    
    initTouchEvents() {
      let startX = 0;
      let currentX = 0;
      let isDragging = false;
      
      this.track.addEventListener('touchstart', (e) => {
        startX = e.touches[0].clientX;
        isDragging = true;
      });
      
      this.track.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        currentX = e.touches[0].clientX;
        const diff = startX - currentX;
        
        // Prevent default to avoid page scroll
        if (Math.abs(diff) > 10) {
          e.preventDefault();
        }
      });
      
      this.track.addEventListener('touchend', (e) => {
        if (!isDragging) return;
        
        const diff = startX - currentX;
        const threshold = 50;
        
        if (Math.abs(diff) > threshold) {
          if (diff > 0) {
            this.next();
          } else {
            this.prev();
          }
        }
        
        isDragging = false;
      });
      
      // Mouse drag events for desktop
      this.track.addEventListener('mousedown', (e) => {
        startX = e.clientX;
        isDragging = true;
        this.track.style.cursor = 'grabbing';
      });
      
      this.track.addEventListener('mousemove', (e) => {
        if (!isDragging) return;
        currentX = e.clientX;
      });
      
      this.track.addEventListener('mouseup', (e) => {
        if (!isDragging) return;
        
        const diff = startX - currentX;
        const threshold = 50;
        
        if (Math.abs(diff) > threshold) {
          if (diff > 0) {
            this.next();
          } else {
            this.prev();
          }
        }
        
        isDragging = false;
        this.track.style.cursor = 'grab';
      });
      
      this.track.addEventListener('mouseleave', () => {
        isDragging = false;
        this.track.style.cursor = 'grab';
      });
    }
    
    goToSlide(index) {
      this.currentIndex = Math.max(0, Math.min(index, this.maxIndex));
      this.updateTrack();
      this.updateDots();
      this.updateNavButtons();
    }
    
    next() {
      if (this.currentIndex < this.maxIndex) {
        this.currentIndex++;
        this.updateTrack();
        this.updateDots();
        this.updateNavButtons();
      }
    }
    
    prev() {
      if (this.currentIndex > 0) {
        this.currentIndex--;
        this.updateTrack();
        this.updateDots();
        this.updateNavButtons();
      }
    }
    
    updateTrack() {
      const translateX = -this.currentIndex * this.slideWidth;
      this.track.style.transform = `translateX(${translateX}px)`;
    }
    
    updateDots() {
      this.dots.forEach((dot, index) => {
        if (index === this.currentIndex) {
          dot.classList.add('bg-blue-500', 'dark:bg-blue-400');
          dot.classList.remove('bg-gray-300', 'dark:bg-gray-600');
        } else {
          dot.classList.remove('bg-blue-500', 'dark:bg-blue-400');
          dot.classList.add('bg-gray-300', 'dark:bg-gray-600');
        }
      });
    }
    
    updateNavButtons() {
      if (this.prevBtn) {
        this.prevBtn.disabled = this.currentIndex === 0;
        this.prevBtn.classList.toggle('opacity-50', this.currentIndex === 0);
      }
      
      if (this.nextBtn) {
        this.nextBtn.disabled = this.currentIndex === this.maxIndex;
        this.nextBtn.classList.toggle('opacity-50', this.currentIndex === this.maxIndex);
      }
    }
    
    startAutoPlay() {
      setInterval(() => {
        if (this.currentIndex < this.maxIndex) {
          this.next();
        } else {
          this.goToSlide(0);
        }
      }, 5000); // Auto-play every 5 seconds
    }
  }
  
  // Initialize gallery when page loads
  document.addEventListener('astro:page-load', () => {
    new SwipeGallery();
  });
  
  document.addEventListener('DOMContentLoaded', () => {
    new SwipeGallery();
  });
</script>

<style>
  .gallery-container {
    cursor: grab;
  }
  
  .gallery-container:active {
    cursor: grabbing;
  }
  
  .gallery-track {
    will-change: transform;
  }
  
  .gallery-slide {
    transition: all 0.3s ease;
  }
  
  .gallery-nav:disabled {
    cursor: not-allowed;
  }
  
  .gallery-dot {
    cursor: pointer;
  }
  
  /* Responsive adjustments */
  @media (max-width: 640px) {
    .gallery-nav {
      width: 2.5rem;
      height: 2.5rem;
    }
    
    .gallery-nav svg {
      width: 1.25rem;
      height: 1.25rem;
    }
  }
</style>